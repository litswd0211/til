## ğŸ“¦ ãƒ¬ãƒ¼ãƒˆãƒªãƒŸãƒƒãƒˆï¼šLeaky Bucket ã¨ Token Bucket ã®æ¯”è¼ƒ

### âœ… ã¯ã˜ã‚ã«

ãƒ¬ãƒ¼ãƒˆãƒªãƒŸãƒƒãƒˆï¼ˆRate Limitingï¼‰ã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚„APIã®ãƒªã‚½ãƒ¼ã‚¹åˆ©ç”¨ã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ã®é‡è¦ãªæŠ€è¡“ã§ã™ã€‚ä»£è¡¨çš„ãªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¨ã—ã¦ã€**Leaky Bucket**ã¨**Token Bucket**ãŒã‚ã‚Šã¾ã™ã€‚

---

### ğŸª£ Leaky Bucketï¼ˆæ¼ã‚Œãƒã‚±ãƒ„æ–¹å¼ï¼‰

#### **ä»•çµ„ã¿**

* ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã—ã¦ã¯ã€Œæ°´ã®å…¥ã‚‹ãƒã‚±ãƒ„ã«ä¸€å®šé€Ÿåº¦ã§æ°´ãŒæ¼ã‚Œã¦ã„ãã€ã€‚
* ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ¥ã‚‹ãŸã³ã«æ°´ï¼ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰ãŒãƒã‚±ãƒ„ã«æºœã¾ã‚Šã€**ä¸€å®šé€Ÿåº¦ã§æ’å‡º**ã•ã‚Œã‚‹ã€‚
* ãƒã‚±ãƒ„ãŒæº¢ã‚Œã‚‹ï¼ˆ=å®¹é‡ã‚’è¶…ãˆã‚‹ï¼‰ã¨ã€ãã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯**ãƒ‰ãƒ­ãƒƒãƒ—ã•ã‚Œã‚‹ï¼ˆæ‹’å¦ã•ã‚Œã‚‹ï¼‰**ã€‚

#### **ç‰¹å¾´**

* **å®‰å®šã—ãŸå‡ºåŠ›ãƒ¬ãƒ¼ãƒˆ**ï¼šã‚¹ãƒ‘ã‚¤ã‚¯ï¼ˆæ€¥å¢—ï¼‰ã‚’å¹³æº–åŒ–ã€‚
* ãƒãƒ¼ã‚¹ãƒˆã®å¸åã¯**ã§ããªã„**ã€‚
* ã‚­ãƒ¥ãƒ¼ã¨ã—ã¦å®Ÿè£…ã•ã‚Œã‚‹ã“ã¨ãŒå¤šã„ã€‚

#### **å›³å¼**

```
[Input Requests] --> [Bucket] --(å®šé€Ÿ)--> [Server]
                     â†‘
                 Overflow = Drop
```

---

### ğŸª™ Token Bucketï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ãƒã‚±ãƒ„æ–¹å¼ï¼‰

#### **ä»•çµ„ã¿**

* ãƒã‚±ãƒ„ã«ãƒˆãƒ¼ã‚¯ãƒ³ãŒä¸€å®šé€Ÿåº¦ã§è£œå……ã•ã‚Œã‚‹ã€‚
* ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ¥ã‚‹ã¨**1ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¶ˆè²»**ã—ã¦å‡¦ç†ã•ã‚Œã‚‹ã€‚
* ãƒˆãƒ¼ã‚¯ãƒ³ãŒè¶³ã‚Šãªã„ã¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯**æ‹’å¦**ã•ã‚Œã‚‹ï¼ˆã¾ãŸã¯å¾…ãŸã•ã‚Œã‚‹ï¼‰ã€‚

#### **ç‰¹å¾´**

* **ãƒãƒ¼ã‚¹ãƒˆå‡¦ç†ãŒå¯èƒ½**ï¼šãƒˆãƒ¼ã‚¯ãƒ³ãŒè²¯ã¾ã£ã¦ã„ã‚Œã°çŸ­æœŸé–“ã®ã‚¹ãƒ‘ã‚¤ã‚¯ã‚’è¨±å®¹ã€‚
* å¹³å¸¸æ™‚ã¯Leaky Bucketã¨ä¼¼ãŸæŒ™å‹•ã€‚
* ãƒã‚±ãƒƒãƒˆå®¹é‡ã«ã‚ˆã£ã¦ãƒãƒ¼ã‚¹ãƒˆã®ä¸Šé™ãŒæ±ºã¾ã‚‹ã€‚

#### **å›³å¼**

```
[Token Generator] --> [Bucket with Tokens] --> [Request Handler]
                            â†“   â†‘
                     Request uses 1 token
                     Reject if token = 0
```

---

### ğŸ” æ¯”è¼ƒè¡¨

| ç‰¹æ€§     | Leaky Bucket  | Token Bucket    |
| ------ | ------------- | --------------- |
| å‡¦ç†é€Ÿåº¦   | ä¸€å®šï¼ˆã‚¹ãƒ ãƒ¼ã‚ºï¼‰      | ãƒãƒ¼ã‚¹ãƒˆå¯ï¼ˆä¸€å®šç¯„å›²å†…ï¼‰    |
| ãƒãƒ¼ã‚¹ãƒˆå¸å | ä¸å¯            | å¯èƒ½              |
| å®Ÿè£…ä¾‹    | ã‚­ãƒ¥ãƒ¼ã§ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚° | ãƒˆãƒ¼ã‚¯ãƒ³ã‚«ã‚¦ãƒ³ãƒˆï¼‹ã‚¿ã‚¤ãƒãƒ¼   |
| é©ç”¨ã‚·ãƒ¼ãƒ³  | å¸¯åŸŸåˆ¶å¾¡ã€QoS      | APIãƒ¬ãƒ¼ãƒˆåˆ¶é™ã€ã‚¹ãƒ­ãƒƒãƒˆåˆ¶å¾¡ |

---

### ğŸ›  å®Ÿè£…å‚è€ƒ

#### Goã®ä¾‹ï¼ˆToken Bucketï¼‰

```go
import (
    "golang.org/x/time/rate"
    "time"
)

limiter := rate.NewLimiter(5, 10) // æ¯ç§’5ãƒªã‚¯ã‚¨ã‚¹ãƒˆã€æœ€å¤§ãƒãƒ¼ã‚¹ãƒˆ10

for {
    if limiter.Allow() {
        go handleRequest()
    } else {
        fmt.Println("Rate limited")
    }
}
```

---

### ğŸ“š å‚è€ƒãƒªãƒ³ã‚¯

* [Wikipedia - Token bucket](https://en.wikipedia.org/wiki/Token_bucket)
* [Wikipedia - Leaky bucket](https://en.wikipedia.org/wiki/Leaky_bucket)
* [Golang.org/x/time/rate](https://pkg.go.dev/golang.org/x/time/rate)

---

## ğŸ§  ã¾ã¨ã‚

| ç”¨é€”           | æ¨å¥¨ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ      |
| ------------ | ------------ |
| å¸¸ã«ä¸€å®šé€Ÿåº¦ã®å‡ºåŠ›ãŒé‡è¦ | Leaky Bucket |
| ãƒãƒ¼ã‚¹ãƒˆã‚’è¨±å®¹ã—ãŸã„   | Token Bucket |

---
